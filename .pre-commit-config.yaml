# Pre-commit configuration - FLEXT API
# Standard FLEXT enterprise configuration with API-specific dependencies
# Based on FLEXT workspace standards

minimum_pre_commit_version: "3.5.0"
fail_fast: false
default_stages: [pre-commit, pre-push]
default_language_version:
  python: python3.13

repos:
  # ===== SECURITY SCANNING DISABLED TEMPORARILY - BASELINE ISSUES =====
  # - repo: https://github.com/Yelp/detect-secrets
  #   rev: v1.4.0
  #   hooks:
  #     - id: detect-secrets
  #       name: "ğŸ”’ Detect Secrets"
  #       args: ["--baseline", ".secrets.baseline"]
  #       exclude: .*\.lock$|.*\.lockb$

  # Poetry-managed tools via local repo (most reliable)
  - repo: local
    hooks:
      # Ruff linting and formatting (primary formatter)
      - id: ruff-format
        name: "âš¡ Ruff Format (PEP8 Strict - 79 chars)"
        entry: poetry run ruff format
        language: system
        types: [python]
        require_serial: true
        args: [--check, --diff]

      - id: ruff-lint
        name: "ğŸ”¥ Ruff Lint (ALL categories)"
        entry: poetry run ruff check
        language: system
        types: [python]
        require_serial: true
        args: [
          --fix,
          --exit-non-zero-on-fix,
          --line-length=88,
          --target-version=py313,
          --select=ALL,
          --ignore=COM812,ISC001,D203,D213,TD003,FIX002,ERA001,PLR0912,PLR0913,PLR0915,PLR2004,C901,BLE001,TRY003,EM101,EM102
        ]

      # isort import sorting
      - id: isort
        name: "ğŸ“¦ Import Sort"
        entry: poetry run isort
        language: system
        types: [python]
        require_serial: true
        args: [--check-only, --diff, --profile=ruff, --line-length=88]

      # MyPy type checking (API-specific dependencies)
      - id: mypy
        name: "ğŸ›¡ï¸ MyPy Strict"
        entry: poetry run mypy
        language: system
        types: [python]
        require_serial: true
        pass_filenames: false
        args: [
          src/,
          tests/,
          --config-file=pyproject.toml,
          --strict,
          --warn-unreachable,
          --warn-unused-ignores,
          --no-implicit-reexport,
          --ignore-missing-imports,
          --show-error-codes,
          --show-column-numbers,
          --pretty,
          --python-version=3.13
        ]

      # Bandit security
      - id: bandit
        name: "ğŸ”’ Bandit Security"
        entry: poetry run bandit
        language: system
        types: [python]
        require_serial: true
        pass_filenames: false
        args: [-r, src/, --severity-level=medium, --format=txt]
        exclude: tests/

      # Poetry dependency check
      - id: poetry-check
        name: "ğŸ“¦ Poetry Check"
        entry: poetry check
        language: system
        pass_filenames: false

      # Poetry lock validation
      - id: poetry-lock
        name: "ğŸ”’ Poetry Lock"
        entry: poetry lock
        language: system
        pass_filenames: false

  # Standard file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: check-yaml
        name: "ğŸ“‹ YAML Syntax"
        args: [--unsafe]
      - id: check-toml
        name: "ğŸ“‹ TOML Syntax"
      - id: check-json
        name: "ğŸ“‹ JSON Syntax"
      - id: end-of-file-fixer
        name: "ğŸ“„ EOF Fixer"
      - id: trailing-whitespace
        name: "âœ‚ï¸ Trailing Whitespace"
        args: [--markdown-linebreak-ext=md]
      - id: check-added-large-files
        name: "ğŸ“¦ Large File Check"
        args: [--maxkb=1000]
      - id: check-case-conflict
        name: "ğŸ”¤ Case Conflict"
      - id: check-merge-conflict
        name: "âš”ï¸ Merge Conflict"
      - id: mixed-line-ending
        name: "ğŸ“ Line Ending"
        args: [--fix=lf]
      - id: debug-statements
        name: "ğŸ› Debug Statements"
      - id: check-ast
        name: "ğŸ Python AST"
      - id: check-docstring-first
        name: "ğŸ“ Docstring First"
      - id: detect-private-key
        name: "ğŸ” Private Key Detection"
      - id: check-executables-have-shebangs
        name: "ğŸ“œ Executable Shebangs"
      - id: check-shebang-scripts-are-executable
        name: "ğŸ”§ Shebang Executable"

  # Python-specific checks
  - repo: https://github.com/pre-commit/pygrep-hooks
    rev: v1.10.0
    hooks:
      - id: python-check-blanket-noqa
        name: "ğŸš« Blanket noqa"
      - id: python-check-blanket-type-ignore
        name: "ğŸš« Blanket type: ignore"
      - id: python-no-eval
        name: "ğŸš« No eval()"
      - id: python-no-log-warn
        name: "âš ï¸ No log.warn"
      - id: python-use-type-annotations
        name: "ğŸ“ Type Annotations"

  # Additional quality tools
  - repo: https://github.com/asottile/pyupgrade
    rev: v3.20.0
    hooks:
      - id: pyupgrade
        name: "ğŸ†™ Python Upgrade"
        args: [--py313-plus]

  - repo: https://github.com/PyCQA/autoflake
    rev: v2.3.1
    hooks:
      - id: autoflake
        name: "ğŸ§¹ Remove Unused Imports"
        args: [
          --remove-all-unused-imports,
          --remove-unused-variables,
          --in-place,
          --recursive
        ]

  # Spell checking
  - repo: https://github.com/codespell-project/codespell
    rev: v2.4.1
    hooks:
      - id: codespell
        name: "ğŸ“ Spell Check"
        args: [
          "--skip=*.json,*.lock,*.toml,*.yaml,*.yml,poetry.lock",
          "--ignore-words-list=flext,api,fastapi,configs,repo,repos,pydantic"
        ]

  # Validate pyproject.toml
  - repo: https://github.com/abravalheri/validate-pyproject
    rev: v0.16
    hooks:
      - id: validate-pyproject
        name: "ğŸ“‹ Validate pyproject.toml"

# CI configuration (Poetry tools disabled in CI)
ci:
  autofix_prs: false  # No automatic fixes - must be intentional
  autoupdate_schedule: weekly
  skip: [
    # Local Poetry hooks don't work in CI
    ruff-format,
    ruff-lint,
    isort,
    mypy,
    bandit,
    poetry-check,
    poetry-lock
  ]
  submodules: false

# API-specific settings
fail_fast: false
